# ------------------------------------------------------------------
# State machines actions for command menu
#

set machine1 {
    {init   		turns 	"cd %d; cvs export -r %V -d %T %P"}
    {cvs-export-OK  	async	"cd %D; make declare"}
    {make-declare-OK	async	"cd %D; set +x; setup -b -f %F %P %V; set -x"}
    {set-+x-OK		async	"cd %D; make all"}
    {make-all-OK	async	"cd %D; make test"}
}

set machine2 {
    {init		all	"cd %D; set +x; setup -b -f %F %P %V; set -x"}
    {set-+x-OK		async	"cd %D; make all"}
    {make-all-OK	async	"cd %D; make test"}
}

set machine3 {
    {init   		turns 	"cd %d; cvs export -r %V -d %T %P"}
    {cvs-export-OK	async	"cd %D; make declare"}
    {make-declare-OK	async	"cd %D; set +x; setup -b -f %F %P %V; set -x"}
    {set-+x-OK		async	"cd %D; make all"}
    {make-all-OK	async	"cd %D; make test"}
    {make-test-OK	async	"cd %D; make clean"}
    {make-clean-OK	async	"cd %D; make auto%R"}
    {make-autokits-Question-1	
			turns	"y"}
    {make-local-OK	async	"cd %d; rm -rf %T"}
    {make-kits-OK	async	"cd %d; rm -rf %T"}
    {cvs-release-Question-1 async "y"}
}

set fastrelease {
    {init			all	"(cd %D; make auto%R)"}
    {make-autokits-Question-1	turns	"y"}
}

array set cmd_menu {
    { 1 cd}	 	  {cmd_parallel  "cd %D"}
    { 2 cvs export}	  {cmd_taketurns "cd %d; cvs export -r %V -d %T %P" }
    { 3 make declare}	  {cmd_taketurns "(cd %D; make declare)"}
    { 4 setup}	  	  {cmd_parallel  "set +x;setup -b -f %F %P %V;set -x"}
    { 5 make all}	  {cmd_parallel  "(cd %D; make all)"}
    { 6 make test}	  {cmd_parallel  "(cd %D; make test)"}
    { 7 make clean}	  {cmd_parallel  "(cd %D; make clean)"}
    { 8 make local|kits}  {cmd_machine $fastrelease}
    { 9 remove source}	  {cmd_parallel  "cd %d; rm -rf %T"}
    {10 auto 1..6}	  {cmd_machine $machine1}
    {11 auto 4..6}	  {cmd_machine $machine2}
    {12 auto 1..9}	  {cmd_machine $machine3}
    {clear auto}	  {clear_statepending}
    {interrupt}	  	  {cmd_parallel  "\x003"}
    {exit} 		  {cmd_parallel  "exit"; after 5000 exit}
}
